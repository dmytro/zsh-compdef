#compdef VBoxManage

# Based on "Oracle VM VirtualBox Command Line Management Interface
# Version 3.2.0" and a close reading of _cvs from the ZSH functions
# directory. Options and arguments are manually specified, which
# may cause drift should VBoxManage change.

_VBoxManage() {
  _arguments -s \
    '(-)'{-v,--version}'[print version number and exit]' \
    '(-)'{-q,--nologo}'[suppress the logo]' \
    '*::VBoxManage command:_VBoxManage_command'
}

# define VBoxManage command dispatch function.

(( $+functions[_VBoxManage_command] )) ||
_VBoxManage_command() {

  (( $+_VBoxManage_cmds )) || _VBoxManage_cmds=(
    'list:Show information about various objects' \
    'showvminfo:Information about a VM' \
    'registervm:Register a VM' \
    'unregistervm:Unregister a VM' \
    'createvm:Create a VM' \
    'modifyvm:Change a VM' \
    'import:Import an OVD image' \
    'export:Export an OVD image' \
    'startvm:Start a VM' \
    'controlvm:Issue commands to a VM' \
    'discardstate:Discard state for a VM' \
    'adoptstate:Adopt a state file for a VM' \
    'snapshot:Snapshot commands for a VM' \
    'openmedium:Open a disk or CD-ROM' \
    'closemedium:Close a disk or CD-ROM' \
    'storageattach:Attach a device' \
    'storagectl:Add or remove a device' \
    'showhdinfo:Show information about a device' \
    'createhd:Create a disk' \
    'modifyhd:Modify a disk' \
    'clonehd:Clone a disk' \
    'convertfromraw:Convert a disk image' \
    'addiscsidisk:Add an iSCSI disk' \
    'getextradata:Get metadata' \
    'setextradata:Set metadta' \
    'setproperty:Set a property' \
    'usbfilter:USB device commands' \
    'sharedfolder:Shared folder commands' \
    'vmstatistics:Show VM statistics' \
    'guestproperty:Interact with guest properties' \
    'guestcontrol:Execute a guest control' \
    'metrics:Interact with metrics commands' \
    'hostonlyif:Network interface command' \
    'dhcpserver:Manage DHCP servers'
  )

  if (( CURRENT == 1 )); then
    _describe -t commands 'VBoxManage command' _VBoxManage_cmds
  else
    local curcontext="$curcontext"

    # TODO figure out how to extirpate the _cvs_syns from this...
    cmd="${_VBoxManage_cmds[(r)$words[1]:*]%%:*}"
    if (( $#cmd )); then
      curcontext="${curcontext%:*:*}:VBoxManage-${cmd}:"
      _call_function ret _VBoxManage_$cmd || _message 'no more arguments'
    else
      _message "unknown VBoxManage command: $words[1]"
    fi
    return ret
  fi
}

# define completion functions for each VBoxManage command

(( $+functions[_VBoxManage_list] )) ||
_VBoxManage_list() {
  _arguments -s \
    '(-)'{-l,--long}'[be verbose]' \
    '1:command:(vms runningvms ostypes hostdvds hostfloppies bridgedifs hostonlyifs dhcpservers hostinfo hostcpuids hddbackends hdds dvds floppies)'
}

# TODO --log exclusive of the other options? Command listed twice ...
(( $+functions[_VBoxManage_showvminfo] )) ||
_VBoxManage_showvminfo() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_registervm] )) ||
_VBoxManage_registervm() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_unregistervm] )) ||
_VBoxManage_unregistervm() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_createvm] )) ||
_VBoxManage_createvm() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_modifyvm] )) ||
_VBoxManage_modifyvm() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_import] )) ||
_VBoxManage_import() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_export] )) ||
_VBoxManage_export() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_startvm] )) ||
_VBoxManage_startvm() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_controlvm] )) ||
_VBoxManage_controlvm() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_discardstate] )) ||
_VBoxManage_discardstate() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_adoptstate] )) ||
_VBoxManage_adoptstate() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_snapshot] )) ||
_VBoxManage_snapshot() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_openmedium] )) ||
_VBoxManage_openmedium() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_closemedium] )) ||
_VBoxManage_closemedium() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_storageattach] )) ||
_VBoxManage_storageattach() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_storagectl] )) ||
_VBoxManage_storagectl() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_showhdinfo] )) ||
_VBoxManage_showhdinfo() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_createhd] )) ||
_VBoxManage_createhd() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_modifyhd] )) ||
_VBoxManage_modifyhd() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_clonehd] )) ||
_VBoxManage_clonehd() {
  _arguments -s \
    'TODO' \
}

# TODO different exclusive modes to this command as well?
(( $+functions[_VBoxManage_convertfromraw] )) ||
_VBoxManage_convertfromraw() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_addiscsidisk] )) ||
_VBoxManage_addiscsidisk() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_getextradata] )) ||
_VBoxManage_getextradata() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_setextradata] )) ||
_VBoxManage_setextradata() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_setproperty] )) ||
_VBoxManage_setproperty() {
  _arguments -s \
    'TODO' \
}

# TODO this has various exclusive subcommands
(( $+functions[_VBoxManage_usbfilter] )) ||
_VBoxManage_usbfilter() {
  _arguments -s \
    'TODO' \
}

# TODO this has various exclusive subcommands
(( $+functions[_VBoxManage_sharedfolder] )) ||
_VBoxManage_sharedfolder() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_vmstatistics] )) ||
_VBoxManage_vmstatistics() {
  _arguments -s \
    'TODO' \
}

# TODO this has various exclusive subcommands
(( $+functions[_VBoxManage_guestproperty] )) ||
_VBoxManage_guestproperty() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_guestcontrol] )) ||
_VBoxManage_guestcontrol() {
  _arguments -s \
    'TODO' \
}

# TODO this has various exclusive subcommands
(( $+functions[_VBoxManage_metrics] )) ||
_VBoxManage_metrics() {
  _arguments -s \
    'TODO' \
}

(( $+functions[_VBoxManage_hostonlyif] )) ||
_VBoxManage_hostonlyif() {
  _arguments -s \
    'TODO' \
}

# TODO this has various exclusive subcommands
(( $+functions[_VBoxManage_dhcpserver] )) ||
_VBoxManage_dhcpserver() {
  _arguments -s \
    'TODO' \
}
